public class SwiftInboundRepository(IConfiguration cfg, ILogger<SwiftInboundRepository> logger) : IRepository<SwiftInboundMQ>
{
    private readonly ILogger<SwiftInboundRepository> _logger = logger;
    private readonly string _connString = cfg.GetConnectionString("LAVA") ?? string.Empty;

    public async Task AddAsync(SwiftInboundMQ swiftInboundMQ, CancellationToken ct)
    {
        _logger.LogInformation("Add MQ swift inbound message to LAVA db. CorrelationID: {CorrelationID}", swiftInboundMQ.CorrelationID);
        try
        {
            using var conn = new SqlConnection(_connString);
            using (var cmd = new SqlCommand("dbo.p_ProcessInboundSwiftMessage", conn))
            {
                cmd.CommandType = System.Data.CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("@pMsgType", swiftInboundMQ.MessageType);                    
                cmd.Parameters.AddWithValue("@xmlInboundSwiftMessageData", swiftInboundMQ.InboundSwiftMessageData);
                cmd.Parameters.AddWithValue("@pUserId", swiftInboundMQ.UserID);
                cmd.Parameters.AddWithValue("@pXMLSwiftMessageData", swiftInboundMQ.SwiftMessageData);
                cmd.Parameters.AddWithValue("@IsSuccess", swiftInboundMQ.IsSuccess);
                cmd.Parameters.AddWithValue("@pProcessedFileName", swiftInboundMQ.ProcessedFileName);
                await conn.OpenAsync(ct);
                await cmd.ExecuteNonQueryAsync(ct);
            }
                ;
            await conn.CloseAsync();
        }
        catch (Exception ex)
        {
            _logger.LogError("Error while adding MQ swift inbound message to LAVA db. CorrelationID: {CorrelationID}. Exception: {ErrorMsg}",
                            swiftInboundMQ.CorrelationID, ex.Message);
            throw;
        }

    }

    

}


public static DataSet SaveInboundMessage(string MessageType, string ParsedFileName, string UserId, string applicationDBName, string xmlSwiftData, string xmlInboundSwiftData, ref bool blnSuccess)
{
    try
    {
        using (SqlConnection connection = SqlConnections.AppliCationDBConnection(applicationDBName))
        {
            SqlParameter[] parameters = new SqlParameter[6];
            parameters[0] = new SqlParameter(ConstantsDAL.PARAM_MSGTYPE, MessageType);                    
            parameters[1] = new SqlParameter(ConstantsDAL.PARAM_XMLSWIFTMSGDATA, xmlInboundSwiftData);
            parameters[2] = new SqlParameter(ConstantsDAL.PARAM_USERID, UserId);
            parameters[3] = new SqlParameter(ConstantsDAL.PARAM_SWIFTMESSAGEDATA, xmlSwiftData);
            parameters[4] = new SqlParameter(ConstantsDAL.PARAM_ISSUCCESS, blnSuccess);
            parameters[5] = new SqlParameter(ConstantsDAL.PARAM_FILENAME, ParsedFileName);
            parameters[4].Direction = ParameterDirection.Output;

            DataSet ds = StoredProcSql.ExecuteDataSet(connection, ConstantsDAL.SPNAME_PROCESSINBOUNDSWIFTMESSAGE, parameters);

            if (parameters[4].Value != null)
                blnSuccess = Convert.ToBoolean(parameters[4].Value);

            return ds;
        }
    }
    catch (Exception ex)
    {
        _logger.LogErrorMessage(applicationDBName + " - " + MessageType, "Error in method SaveInboundMessage", ex, true,
                               MethodBase.GetCurrentMethod().Name, new string[] {"Stored Procedure", "ParsedFileName", "UserId" },
                               ConstantsDAL.SPNAME_PROCESSINBOUNDSWIFTMESSAGE, ParsedFileName, UserId);

        throw new Exception(Constants.CONS_METHOD_SAVEINBOUNDMESSAGE); 

    }
}
