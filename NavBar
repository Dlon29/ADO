public async Task ConsumeMessagesAsync(CancellationToken ct)
{
    try
    {
        foreach (var mqMessage in _swiftInboundMQSubscriber.ReadMessages(ct))
        {
            try
            {
                var swiftMessages = _swiftInboundFactory.ReadSwiftMessagesFromMQ(
                    mqMessage.Payload,
                    mqMessage.CorrelationId,
                    _tagCompData,
                    _mqConfiguration.MessageTypes // use MQ config instead of FTP element
                );

                foreach (var swiftMessage in swiftMessages)
                {
                    var entity = MapToSwiftInboundMQ(swiftMessage);
                    await _swiftInboundRepository.AddAsync(entity, ct);
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(
                    ex,
                    "Error processing MQ message. CorrelationId: {CorrelationId}",
                    mqMessage.CorrelationId
                );
            }
        }
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Error while consuming MQ messages.");
    }
}



public InboundSwiftMessageCollection ReadSwiftMessagesFromMQ(
    string mqPayload,
    string correlationId,
    string tagCompData,
    string filterMessageTypes)
{
    List<string> lstMessages = new();
    List<KeyValuePair<string, string>> lstMessageFilename = new();

    ApplicationHeaderBlock applicationHeader = new(mqPayload);

    string[] filterTypes = filterMessageTypes
        .Replace(Constants.CONS_MESSAGETYPESTART, "")
        .Split('|');

    if (!filterTypes.Contains(applicationHeader.MessageType))
        return new InboundSwiftMessageCollection();

    lstMessages.Add(mqPayload);
    lstMessageFilename.Add(
        new KeyValuePair<string, string>(correlationId, mqPayload)
    );

    // Parsing only â€“ no DB call
    return new InboundSwiftMessageCollection(
        lstMessages,
        tagCompData,
        lstMessageFilename
    );
}


public class MQConfiguration
{
    public string QueueName { get; set; } = string.Empty;
    public string SubscriberName { get; set; } = string.Empty;
    public string MessageTypes { get; set; } = string.Empty; // Example: ":STP|:MT103|:MT202"
}



{
  "MQInboundSettings": {
    "QueueName": "INBOUND_SWIFT",
    "SubscriberName": "SwiftConsumer",
    "MessageTypes": ":STP|:MT103|:MT202"
  }
}


private readonly MQConfiguration _mqConfiguration;

public SwiftInboundConsumer(IConfiguration cfg, ...)
{
    _mqConfiguration = cfg.GetSection("MQInboundSettings").Get<MQConfiguration>();
}
