public class SwiftInboundRepository(IConfiguration cfg, ILogger<SwiftInboundRepository> logger) : IRepository
{
    private readonly ILogger<SwiftInboundRepository> _logger = logger;
    private readonly string _connString = cfg.GetConnectionString("LAVA") ?? string.Empty;

   public async Task AddAsync<T>(T swiftInboundMQ, CancellationToken ct) where T : SwiftInboundMQ
    {
        _logger.LogInformation("Add MQ swift inbound message to LAVA db. CorrelationID: {CorrelationID}", swiftInboundMQ.CorrelationID);
        try
        {
            using var conn = new SqlConnection(_connString);
            using (var cmd = new SqlCommand("dbo.p_ProcessInboundSwiftMessage_Test", conn))
            {
                cmd.CommandType = System.Data.CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("@pMsgType", swiftInboundMQ.MessageType);
                cmd.Parameters.AddWithValue("@xmlInboundSwiftMessageData", swiftInboundMQ.InboundSwiftMessageData);
                cmd.Parameters.AddWithValue("@pUserId", swiftInboundMQ.UserID);
                cmd.Parameters.AddWithValue("@pXMLSwiftMessageData", swiftInboundMQ.SwiftMessageData);
                cmd.Parameters.AddWithValue("@IsSuccess", swiftInboundMQ.IsSuccess);
                cmd.Parameters.AddWithValue("@pProcessedFileName", swiftInboundMQ.ProcessedFileName);
                await conn.OpenAsync(ct);
                await cmd.ExecuteNonQueryAsync(ct);
            };
            await conn.CloseAsync();
        }
        catch (Exception ex)
        {
            _logger.LogError("Error while adding MQ swift inbound message to LAVA db. CorrelationID: {CorrelationID}. Exception: {ErrorMsg}",
                            swiftInboundMQ.CorrelationID, ex.Message);
            throw;
        }
    }



public class SwiftInboundConsumer(ILogger<SwiftInboundConsumer> logger,
                             ISubscriber swiftInboundMQSubscriber,
                             ISwiftInboundFactory swiftInboundMQFactory,
                             IRepository swiftInboundMQRepository) : ISwiftInboundConsumer
{
    private readonly ISubscriber _swiftInboundMQSubscriber = swiftInboundMQSubscriber;
    private readonly IRepository _swiftInboundRepository = swiftInboundMQRepository;
    private readonly ISwiftInboundFactory _swiftInboundFactory = swiftInboundMQFactory;
    private readonly ILogger<SwiftInboundConsumer> _logger = logger;


    string contextTagCompData = "{...}"; 

    public async Task ConsumeMessagesAsync(CancellationToken ct)
    {
        try
        {
            foreach (var swiftInboundPayload in _swiftInboundMQSubscriber.ReadMessages(ct))
            {
                try
                {
                    _logger.LogInformation("Consumed swift inbound MQ message. Payload: {SwiftInboundPayload}", swiftInboundPayload);
                    var swiftInboundMQ = _swiftInboundFactory.ReadSwiftMessages(contextTagCompData, swiftInboundPayload);
                    await _swiftInboundRepository.AddAsync<SwiftInboundMQ>(swiftInboundMQ[0], ct);
                }
                catch (Exception payloadEx)
                {
                    _logger.LogError(payloadEx, "Error while processing messages. Payload: {SwiftInboundPayload} ", swiftInboundPayload);
                }
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error while processing position messages.");
        }

    }
}



public List<SwiftInboundMQ> ReadSwiftMessages(string swiftInboundPayload, string tagCompData)
{}


 public static DataSet GetSwiftTagComponentData(string applicationDBName)
 {
     try
     {
         using (SqlConnection connection = SqlConnections.AppliCationDBConnection(applicationDBName))
         {
             SqlParameter[] parameters = new SqlParameter[0];
             return StoredProcSql.ExecuteDataSet(connection, ConstantsDAL.p_GetSwiftData, parameters);
         }
     }
     catch (Exception ex)
     {

         _logger.LogErrorMessage(applicationDBName,"Error in method GetSwiftTagComponentData", ex, true,
                                MethodBase.GetCurrentMethod().Name, new string[] { "applicationDBName", "Stored Procedure" }, applicationDBName, ConstantsDAL.SPNAME_GETSWIFTTAGCOMPONENTDATA);

         throw;
     }
 }


public static DataSet GetSwiftTagComponentData(string applicationDBName)
{
    try
    {
        DataSet ds = SwiftInboundDAL.GetSwiftTagComponentData(applicationDBName);

        if (ds != null)
        {
            ds.Tables[0].TableName = "SwiftTagComponent";
        }

        return ds;

    }
    catch (Exception)
    {

        throw;
    }

}


private void ProcessEachCouriers(FtpConfigurationElement item)
{
    string tagCompData = String.Empty;

    try
    {
        _logger.LogInfoFormat(item.DBName + " - " + item.MessageTypes, Constants.CONS_STARTEXECUTING_SwiftTagComponentData, MethodBase.GetCurrentMethod().Name, MethodBase.GetCurrentMethod().DeclaringType.Name);
       
        DataSet dsResult = SWIFTInbound.GetSwiftTagComponentData(item.DBName);
        tagCompData = Common.Common.ConvertObjectToXMLString(dsResult.Tables[0]);

        courier.Read(tagCompData, item);
    }
    catch (Exception ex)
    {
        _logger.LogErrorMessage(item.DBName + " - " + item.MessageTypes, Constants.CONS_INBOUND_COURIER_MESSAGE_ERROR, ex, true,
                                Constants.CONS_METHOD_PROCESSEACHCOURIERS, new string[] {"DBName", "tagCompData"}, item.DBName, tagCompData);
    }
}


 public void Read(string tagCompData, FtpConfigurationElement item)
 {
     this.ReadSwiftMessages(tagCompData, item);
 }
