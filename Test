USE REFERENCE;
GO

IF EXISTS
(
    SELECT *
    FROM sys.objects
    WHERE object_id = OBJECT_ID(N'dbo.Country')
          AND type IN ( N'U' )
)
   AND NOT EXISTS
(
    SELECT *
    FROM sys.objects
    WHERE object_id = OBJECT_ID(N'dbo.Country_GCR')
          AND type IN ( N'U' )
)
BEGIN
    IF EXISTS
    (
        SELECT *
        FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS
        WHERE CONSTRAINT_NAME = 'PK__Country'
    )
        ALTER TABLE dbo.Country DROP CONSTRAINT PK__Country;

    IF EXISTS
    (
        SELECT *
        FROM sys.default_constraints
        WHERE name = 'DF_Country_IsDeleted'
    )
        ALTER TABLE dbo.Country DROP CONSTRAINT DF_Country_IsDeleted;

    IF EXISTS
    (
        SELECT *
        FROM sys.default_constraints
        WHERE name = 'DF_Country_ModifiedBy'
    )
        ALTER TABLE dbo.Country DROP CONSTRAINT DF_Country_ModifiedBy;


    IF EXISTS
    (
        SELECT *
        FROM sys.default_constraints
        WHERE name = 'DF_Country_ModifiedDate'
    )
        ALTER TABLE dbo.Country DROP CONSTRAINT DF_Country_ModifiedDate;

    EXEC sp_rename 'Country', 'Country_GCR';


	CREATE TABLE dbo.Country
	(
		CountryID INT NOT NULL,
		ISOCountry VARCHAR(2) NOT NULL,
		ISOCountry3 VARCHAR(3) NOT NULL,
		ISOCurrency VARCHAR(3) NULL,
		CountryName VARCHAR(50) NOT NULL,
		CDSCountryCodeNo SMALLINT NOT NULL,
		BaNCSBusinessDate DATE NOT NULL,
		FileHeaderDate DATETIME NOT NULL,
		IsOECD BIT NULL,
		IsDeleted BIT NOT NULL,
		CreatedBy VARCHAR(50) NOT NULL,
		CreatedDate DATETIME NOT NULL,
		ModifiedBy VARCHAR(50) NOT NULL,
		ModifiedDate DATETIME NOT NULL,
		CONSTRAINT PK_Country
			PRIMARY KEY CLUSTERED (CountryID ASC)
			WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON,
				  ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF
				 ) ON [PRIMARY]
	) ON [PRIMARY];

END;

GO



IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'ModifiedDate'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ModifiedDate'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'ModifiedBy'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ModifiedBy'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'CreatedDate'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CreatedDate'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'CreatedBy'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CreatedBy'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'IsDeleted'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'IsDeleted'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'IsOECD'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'IsOECD'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'FileHeaderDate'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'FileHeaderDate'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'BaNCSBusinessDate'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'BaNCSBusinessDate'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'CDSCountryCodeNo'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CDSCountryCodeNo'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'CountryName'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CountryName'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'ISOCurrency'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ISOCurrency'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'ISOCountry3'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ISOCountry3'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'ISOCountry'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ISOCountry'
GO

IF  EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'Country', N'COLUMN',N'CountryID'))
EXEC sys.sp_dropextendedproperty @name=N'MS_Description' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CountryID'
GO


EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Country ID from G+' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CountryID'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Two chars ISO Country Code' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ISOCountry'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Three ISO Country code' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ISOCountry3'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Three char ISO Currency code' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ISOCurrency'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Country Name' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CountryName'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'CDS Country Code No, do not use' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CDSCountryCodeNo'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'BaNCS Business Date from Country extract file header' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'BaNCSBusinessDate'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'BaNCS File Header Date from Country extract file' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'FileHeaderDate'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Is in OECD organization' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'IsOECD'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'IsDeleted flag for deleted record' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'IsDeleted'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'First time the record created in table by user' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CreatedBy'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'First time the record created in table' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'CreatedDate'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Record modified by user' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ModifiedBy'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Record modified time by user' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Country', @level2type=N'COLUMN',@level2name=N'ModifiedDate'
GO


IF EXISTS
(
    SELECT *
    FROM sys.objects
    WHERE object_id = OBJECT_ID(N'dbo.Country')
          AND type IN ( N'U' )
)
   AND EXISTS
(
    SELECT *
    FROM sys.objects
    WHERE object_id = OBJECT_ID(N'dbo.Country_GCR')
          AND type IN ( N'U' )
)

BEGIN

TRUNCATE TABLE dbo.Country

INSERT INTO dbo.Country 
(
	   CountryID
      ,ISOCountry
      ,ISOCountry3
      ,ISOCurrency
      ,CountryName
      ,CDSCountryCodeNo
      ,BaNCSBusinessDate
      ,FileHeaderDate
      ,IsOECD
      ,IsDeleted
      ,CreatedBy
      ,CreatedDate
      ,ModifiedBy
      ,ModifiedDate
)

SELECT 
	   CountryID
      ,ISOCountry
      ,ISOCountry3
      ,ISOCurrency
      ,CountryName
      ,CDSCountryCodeNo = 0
      ,BaNCSBusinessDate = GETDATE()
      ,FileHeaderDate = GETDATE()
      ,IsOECD
      ,IsDeleted
      ,CreatedBy = SUSER_SNAME()
      ,CreatedDate = GETDATE()
      ,ModifiedBy
      ,ModifiedDate

FROM dbo.Country_GCR

END

GO
