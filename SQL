CREATE PROCEDURE [dbo].[p_UpdateCDSMQPositionStatus]
(	
	@pRequestId INT,	
	@pStatus INT
)
AS 
BEGIN 
	SET NOCOUNT ON;

	DECLARE @IsDeleted BIT = 0 	
	DECLARE @StatusNotProcessed INT = 100

	BEGIN TRAN

	UPDATE dbo.CDSMQ_Position
	SET
		[Status] = @pStatus,
		ModifiedOn = GETDATE()			
	WHERE
		RequestId = @pRequestId AND			
		[Status]  = @StatusNotProcessed AND
		IsDeleted = @IsDeleted

	IF @@ROWCOUNT = 0
	BEGIN
		ROLLBACK TRAN
		RETURN
	END

	COMMIT TRAN

	SET NOCOUNT OFF; 
END 
GO
