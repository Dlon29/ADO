IF(@Identifier = 'SWIFT')
BEGIN			
    -- Insert records where Toe is in ('OSL', 'CSD') and only one record per BGNREF in SettlementSwiftMsg
    INSERT INTO dbo.SettlementSwiftMsg
    (
        SettlementStatusHeaderID,
        SwiftMsgID,
        ModifiedBy,
        ModifiedDate
    )
    SELECT
        @SettlementStatusHeaderID,
        swift.Items,
        @ModifiedBy,
        GETDATE()
    FROM
        dbo.f_Split(@SwiftMsgID, ',') swift
    INNER JOIN OPENXML(@hdoc, '/Txnlist/FieldName', 1)
    WITH
    (
        BGNREF VARCHAR(12),
        Toe VARCHAR(3)  -- Assuming Toe is a field inside the XML
    ) AS XmlData
    WHERE 
        XmlData.Toe IN ('OSL', 'CSD')  -- Filter for Toe in ('OSL', 'CSD')
    GROUP BY
        swift.Items  -- Ensures only one record is inserted per SwiftMsgID
  
    -- Insert records for BGNREFs where Toe is NOT in ('OSL', 'CSD')
    INSERT INTO dbo.SettlementSwiftMsg
    (
        SettlementStatusHeaderID,
        SwiftMsgID,
        ModifiedBy,
        ModifiedDate
    )
    SELECT
        @SettlementStatusHeaderID,
        swift.Items,
        @ModifiedBy,
        GETDATE()
    FROM
        dbo.f_Split(@SwiftMsgID, ',') swift
    INNER JOIN OPENXML(@hdoc, '/Txnlist/FieldName', 1)
    WITH
    (
        BGNREF VARCHAR(12),
        Toe VARCHAR(3)  -- Assuming Toe is a field inside the XML
    ) AS XmlData
    WHERE 
        XmlData.Toe NOT IN ('OSL', 'CSD')  -- Insert records with Toe not in ('OSL', 'CSD')
END
